#!/bin/sh
#
# Recursively list files matching the given string within an optional root dir.
# Use -v as the first argument to list the matching lines.

opts='-Il'
root='.'

[ $# -gt 0 ] || {
  printf '%s: [-v] [root] [re]\n' $(basename $0) >&2
  exit 64
}

[ "$1" = '-v' ] && {
  opts='-In'
  shift
}

[ -d "$1" ] && {
  root="$1"
  shift
}

if $(echo "$@" | grep -ve '[A-Z]' > /dev/null); then
  opts="${opts}i"
fi

find "$root" -path '*/.git' -prune \
  -o -path '*/.hg' -prune \
  -o -path '*/.svn' -prune \
  -o -path '*/node_modules' -prune \
  -o -name '*.swp' -prune \
  -o -name '*.pyc' -prune \
  -o -type f -print0 | xargs -0 grep $opts -e "$@"

#!/usr/bin/env bash

function f() {
  local opts="-I"
  local root="."

  if $(echo "$@" | grep -ve "[A-Z]" > /dev/null); then
    local opts="${opts}i"
  fi

  if [ "$1" = '-v' ]; then
    local opts="${opts}n"
    shift
  else
    local opts="${opts}l"
  fi

  if [ -d "$1" ]; then
    root="$1"
    shift
  fi

  find "$root" -path '*/.git' -prune \
    -o -path '*/.hg' -prune \
    -o -path '*/.svn' -prune \
    -o -name '*.swp' -prune \
    -o -name '*.pyc' -prune \
    -o -type f -print0 | xargs -0 grep $opts --color=auto "$@"
}

f "$@"
